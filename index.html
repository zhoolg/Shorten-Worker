<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="stylesheet" href="https://gcore.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha256-L/W5Wfqfa0sdBNIKN9cG6QA5F2qx4qICmU2VgLruv9Y=" crossorigin="anonymous">
  <script>
    if (window.screen.width <= 420) {
      document.getElementsByTagName('meta')['viewport'].content = "initial-scale=0.4, maximum-scale=1.0, minimum-scale=0.4, user-scalable=no";
    } else if (window.screen.width <= 769) {
      document.getElementsByTagName('meta')['viewport'].content = "initial-scale=0.6, maximum-scale=1.0, minimum-scale=0.6, user-scalable=no";
    }
  </script>
  <title>Shorter Url</title>
  <style>
    body {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: linear-gradient(180deg, #658FFF 0%, #3670FF 100%);
      overflow: hidden;
    }
    .card {
      width: 90%;
      max-width: 600px;
      background: #231D34;
      box-shadow: 0px 2px 20px 0px rgba(0, 0, 0, 0.22);
      border-radius: 15px;
      border-width: 0;
      overflow: hidden;
      color: white;
      padding: 20px;
    }
    .modal-content {
      color: black;
    }
    .spinner-border-sm {
      width: 1rem;
      height: 1rem;
    }
    .quote {
      font-size: 1.2rem;
      margin: 15px 0;
    }
    .footer-link {
      text-decoration: none;
      color: #3F76FF;
    }
  </style>
</head>
<body>
  <div class="card text-center">
    <h5 class="mb-4">🎁 缩短您的链接 !</h5>
    <h5 class="mb-3">请输入要缩短的长网址：</h5>
    <div class="input-group mb-3">
      <input type="text" class="form-control" placeholder="Example: https://example.com/" id="text">
      <div class="input-group-append">
        <button class="btn btn-primary" type="button" onclick="shorturl()" id="searchbtn">缩短</button>
      </div>
    </div>
    <div class="quote">
      <p id="hitokoto">「我最深的忧愁，被你折成花。」</p>
      <p id="from"></p>
    </div>
    <p class="mt-4">Powered by <a href="https://www.zhoolg.com" class="footer-link" target="_self">ZhoolG</a></p>
  </div>

  <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">结果</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" id="result">没有结果</div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" onclick='copyurl("result")' data-toggle="popover" data-placement="bottom" data-content="Copied!">Copy</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://gcore.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.slim.min.js" integrity="sha256-pasqAKBDmFT4eHoN2ndd6lN370kFiGUFyTiUHWhU7k8=" crossorigin="anonymous"></script>
  <script src="https://gcore.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
  <script src="https://gcore.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js" integrity="sha256-WqU1JavFxSAMcLP2WIOI+GB2zWmShMI82mTpLDcqFUg=" crossorigin="anonymous"></script>

  <script>
    function load() {
      var xhr = new XMLHttpRequest();
      xhr.open('GET', 'https://v1.hitokoto.cn/?encode=json');
      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4 && xhr.status === 200) {
          var data = JSON.parse(xhr.responseText);
          var hitokoto = document.getElementById('hitokoto');
          var fromm = document.getElementById("from");
          hitokoto.innerText = "『" + data.hitokoto + "』";
          fromm.innerText = '——[' + data.from + ']';
        }
      };
      xhr.send();
    }

    window.onload = function () {
      setInterval(load, 5000);
    };

    function shorturl() {
      var textInput = document.querySelector("#text");
      if (textInput.value == "") {
        alert("Url cannot be empty!");
        return;
      }
      var searchBtn = document.getElementById("searchbtn");
      searchBtn.disabled = true;
      searchBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Please wait...';

      var xhr = new XMLHttpRequest();
      xhr.open('POST', window.location.pathname, true);
      xhr.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');
      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4 && xhr.status === 200) {
          var res = JSON.parse(xhr.responseText);
          searchBtn.disabled = false;
          searchBtn.innerHTML = '缩短';
          if (res.key !== "") {
            document.getElementById("result").innerHTML = window.location.host + '/' + res.key;
            $('#exampleModal').modal('show');
          }
        } else if (xhr.readyState === 4) {
          alert("Unknown error. Please retry!");
          console.log(xhr.statusText);
          searchBtn.disabled = false;
          searchBtn.innerHTML = '缩短';
        }
      };
      xhr.send(JSON.stringify({ url: textInput.value }));
    }

    function copyurl(id, attr) {
      let target = null;
      if (attr) {
        target = document.createElement('div');
        target.id = 'tempTarget';
        target.style.opacity = '0';
        if (id) {
          let curNode = document.querySelector('#' + id);
          target.innerText = curNode[attr];
        } else {
          target.innerText = attr;
        }
        document.body.appendChild(target);
      } else {
        target = document.querySelector('#' + id);
      }
      try {
        let range = document.createRange();
        range.selectNode(target);
        window.getSelection().removeAllRanges();
        window.getSelection().addRange(range);
        document.execCommand('copy');
        window.getSelection().removeAllRanges();
        console.log('Copy success');
      } catch (e) {
        console.log('Copy error');
      }
      if (attr) {
        target.parentElement.removeChild(target);
      }
    }

    $(function () {
      $('[data-toggle="popover"]').popover();
    });
  </script>
</body>
</html>
